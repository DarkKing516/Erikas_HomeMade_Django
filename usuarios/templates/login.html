{% load static %}
<!DOCTYPE html>
<html class="wide wow-animation" lang="en">

<head>
    <title>Erika's HomeMade</title>
    <link rel="shortcut icon" href="https://cdn.pixabay.com/photo/2023/04/17/07/26/ai-generated-7931805_960_720.jpg" />
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/513/513865.png" />
    <link rel="shortcut icon" href="{% static 'images/logo.png' %}" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport"
        content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta charset="utf-8" />

    <!-- Stylesheets-->
    <link rel="stylesheet" type="text/css"
        href="//fonts.googleapis.com/css?family=Roboto:100,300,300i,400,500,600,700,900%7CRaleway:500" />
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}" />
    <link rel="stylesheet" href="{% static 'css/fonts.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="{% static 'css/signin.css' %}" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{% static 'js/signin.js' %}"></script>
</head>

<body>
    <div class="body">
        <form method="post" class="form_main" id="loginForm" onsubmit="return validateLoginForm()">
            {% csrf_token %}
            <p class="heading">Iniciar Sesión</p>
            <div class="inputContainer">
                <i class="bi bi-envelope inputIcon"></i>
                {{ form.correo }}
            </div>

            <div class="inputContainer">
                <i class="bi bi-lock-fill inputIcon"></i>
                {{ form.contraseña }}
            </div>

            <button type="submit" id="button">Ingresar</button>
            <div style="z-index: 5; text-align: center">
                <a class="forgotLink" href="./forgot.html">Olvidé mi contraseña</a>
                <a class="forgotLink" href="./signup.html">Registrarme</a>
                <a class="btn btn-secondary" href="{% url 'home:index' %}">Atrás</a>
            </div>
        </form>
    </div>
</body>
<script>
    $(document).ready(function () {
        $('#loginForm').submit(function (event) {
            event.preventDefault(); // Evita el envío del formulario por defecto
            
            // Realiza una solicitud AJAX para enviar los datos del formulario
            $.ajax({
                type: 'POST',
                url: '{% url "usuarios:login" %}',
                data: $(this).serialize(),
                success: function (response) {
                    if (response.success) {
                        // Inicio de sesión exitoso, redirige al dashboard
                        Swal.fire({
                            icon: "success",
                            title: "Inicio de Sesión Exitoso",
                            text: "Bienvenido",
                            showCancelButton: false,
                            confirmButtonText: "Ir al dashboard",
                        }).then(() => {
                            window.location.href = "{% url 'home:index' %}";
                        });
                    } else {
                        // Muestra el SweetAlert2 correspondiente según el tipo de error
                        if (response.error_type === 'contraseña') {
                            Swal.fire({
                                icon: "error",
                                title: "Error",
                                text: "Contraseña incorrecta. Por favor, inténtelo de nuevo.",
                            });
                        } else if (response.error_type === 'correo') {
                            Swal.fire({
                                icon: "error",
                                title: "Error",
                                text: "Correo electrónico no registrado. Por favor, verifique sus credenciales.",
                            });
                        }
                    }
                }
            });
        });
    });
    </script>
    
</html>